<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Admin Portal - SAN University</title>
    <link rel="stylesheet" href="styles.css" />
    <link
      rel="stylesheet"
      href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css"
    />
    <link
      href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap"
      rel="stylesheet"
    />
  </head>
  <body class="admin-theme">
    <div class="dashboard" id="dashboard" style="display: block">
      <div class="navbar">
        <div class="logo-container" id="adminNavLogo">
          <img src="/public/logo.png" alt="SAN Logo" class="navbar-logo" />
          <h1><i class="fas fa-user-shield"></i> SAN Admin</h1>
        </div>
        <div class="user-info">
          <div class="user-avatar">A</div>
          <div style="display: flex; flex-direction: column; text-align: right">
            <span id="adminName">Administrator</span>
            <span style="font-size: 0.75em; color: #cbd5e1"
              >System Control</span
            >
          </div>
          <button class="logout-btn" onclick="logout()">Logout</button>
        </div>
      </div>

      <div class="dashboard-content">
        <div class="main-panel">
          <div id="view-overview" class="view-section active">
            <div class="welcome-section">
              <h2>Admin Control Center</h2>
              <p>Manage courses, students, faculty, and academic records.</p>
            </div>
            <div class="stats-grid">
              <div
                class="stat-card"
                onclick="switchAdminView('students', document.querySelector('.nav-btn[onclick*=\'students\']'))"
              >
                <h3>50</h3>
                <p>Total Students</p>
              </div>
              <div
                class="stat-card"
                onclick="switchAdminView('courses', document.querySelector('.nav-btn[onclick*=\'courses\']'))"
              >
                <h3>42</h3>
                <p>Total Courses</p>
              </div>
              <div
                class="stat-card"
                onclick="switchAdminView('faculty', document.querySelector('.nav-btn[onclick*=\'faculty\']'))"
              >
                <h3>27</h3>
                <p>Faculty Members</p>
              </div>
              <div class="stat-card">
                <h3>Active</h3>
                <p>System Status</p>
              </div>
            </div>
          </div>

          <div id="view-profile" class="view-section">
            <div class="card">
              <h3><i class="fas fa-id-card"></i> Administrator Profile</h3>
              <div style="display: flex; gap: 30px; align-items: flex-start">
                <div
                  style="
                    width: 120px;
                    height: 120px;
                    border-radius: 50%;
                    overflow: hidden;
                    border: 4px solid #fee2e2;
                  "
                >
                  <img
                    id="adminProfileImg"
                    src=""
                    alt="Admin"
                    style="width: 100%; height: 100%; object-fit: cover"
                  />
                </div>
                <div>
                  <h2
                    id="adminProfileName"
                    style="margin: 0; font-size: 2em; color: #1f2937"
                  >
                    Loading...
                  </h2>
                  <p
                    id="adminProfileRole"
                    style="color: #dc2626; font-weight: bold; margin-top: 5px"
                  >
                    System Administrator
                  </p>
                  <div style="margin-top: 20px; display: grid; gap: 10px">
                    <div>
                      <strong>Email:</strong>
                      <span id="adminProfileEmail">...</span>
                    </div>
                    <div><strong>Access Level:</strong> Full Control</div>
                  </div>
                </div>
              </div>
            </div>
          </div>

          <div id="view-faculty" class="view-section">
            <div class="card">
              <div class="card-header">
                <h3>
                  <i class="fas fa-chalkboard-teacher"></i> Faculty Management
                </h3>
                <button class="add-btn" onclick="openAddFacultyModal()">
                  <i class="fas fa-plus"></i> Add Faculty
                </button>
              </div>
              <div class="table-responsive">
                <table id="facultyTable">
                  <thead>
                    <tr>
                      <th>ID</th>
                      <th>Name</th>
                      <th>Email</th>
                      <th>Dept</th>
                      <th>Designation</th>
                      <th>Action</th>
                    </tr>
                  </thead>
                  <tbody id="facultyList"></tbody>
                </table>
              </div>
            </div>
          </div>

          <div id="view-students" class="view-section">
            <div class="card">
              <div
                class="card-header"
                style="
                  display: flex;
                  justify-content: space-between;
                  align-items: center;
                  flex-wrap: wrap;
                  gap: 15px;
                "
              >
                <h3 style="margin: 0; padding: 0; border: none">
                  <i class="fas fa-user-graduate"></i> Student Management
                </h3>

                <div style="display: flex; gap: 10px; align-items: center">
                  <div style="position: relative">
                    <i
                      class="fas fa-search"
                      style="
                        position: absolute;
                        left: 10px;
                        top: 50%;
                        transform: translateY(-50%);
                        color: #9ca3af;
                      "
                    ></i>
                    <input
                      type="text"
                      id="studentSearch"
                      placeholder="Search ID or Name..."
                      onkeyup="searchStudents()"
                      style="
                        padding: 10px 10px 10px 35px;
                        border: 1px solid #e5e7eb;
                        border-radius: 6px;
                        outline: none;
                        font-size: 0.9em;
                      "
                    />
                  </div>
                  <button class="add-btn" onclick="openAddStudentModal()">
                    <i class="fas fa-plus"></i> Register Student
                  </button>
                </div>
              </div>

              <div class="table-responsive">
                <table id="studentTable">
                  <thead>
                    <tr>
                      <th>ID</th>
                      <th>Name</th>
                      <th>Dept</th>
                      <th>Advisor</th>
                      <th>Actions</th>
                    </tr>
                  </thead>
                  <tbody id="studentList"></tbody>
                </table>
              </div>
            </div>
          </div>

          <div id="view-courses" class="view-section">
            <div class="card">
              <h3><i class="fas fa-book-open"></i> Add New Course</h3>
              <form class="admin-form" id="addCourseForm">
                <div class="form-grid">
                  <div class="input-group">
                    <label>Course Code</label
                    ><input
                      type="text"
                      id="cCode"
                      placeholder="e.g. CSE101"
                      required
                    />
                  </div>
                  <div class="input-group">
                    <label>Section</label
                    ><input
                      type="number"
                      id="cSection"
                      value="1"
                      min="1"
                      required
                    />
                  </div>
                  <div class="input-group" style="grid-column: span 2">
                    <label>Course Name</label
                    ><input
                      type="text"
                      id="cName"
                      placeholder="Course Name"
                      required
                    />
                  </div>

                  <div class="input-group">
                    <label>Department</label>
                    <select
                      id="cDept"
                      required
                      onchange="loadInstructorsForCourse()"
                    >
                      <option value="" disabled selected>Select Dept</option>
                      <option value="CSE">CSE</option>
                      <option value="EEE">EEE</option>
                      <option value="BBA">BBA</option>
                      <option value="ACT">ACT</option>
                      <option value="ENG">ENG</option>
                    </select>
                  </div>
                  <div class="input-group">
                    <label>Instructor</label>
                    <select id="cInstructor" required disabled>
                      <option value="">Select Department First</option>
                    </select>
                  </div>

                  <div class="input-group">
                    <label>Credits</label>
                    <select
                      id="cCredits"
                      required
                      onchange="handleCreditChange()"
                    >
                      <option value="3" selected>3.0 (Theory Only)</option>
                      <option value="1">1.0 (Theory Only)</option>
                      <option value="4">4.0 (Theory + 2h Lab)</option>
                      <option value="4.5">4.5 (Theory + 3h Lab)</option>
                    </select>
                  </div>
                  <div class="input-group">
                    <label>Room Number</label
                    ><input
                      type="text"
                      id="cRoom"
                      placeholder="e.g. AB1-101"
                      required
                    />
                  </div>

                  <div class="input-group">
                    <label>Theory Days</label>
                    <select id="cTheoryDays" required>
                      <option>Loading...</option>
                    </select>
                  </div>
                  <div class="input-group">
                    <label>Theory Time (1h 30m)</label>
                    <select id="cTheoryTime" required>
                      <option>Loading...</option>
                    </select>
                  </div>
                </div>

                <div
                  id="labSection"
                  style="
                    display: none;
                    margin-top: 15px;
                    padding-top: 15px;
                    border-top: 1px dashed #ccc;
                  "
                >
                  <h4 style="color: #4f46e5; margin-bottom: 10px">
                    <i class="fas fa-flask"></i> Lab Schedule Required
                  </h4>
                  <div class="form-grid">
                    <div class="input-group">
                      <label>Lab Day</label
                      ><select id="cLabDay">
                        <option>Loading...</option>
                      </select>
                    </div>
                    <div class="input-group">
                      <label>Lab Time</label
                      ><select id="cLabTime"></select>
                    </div>
                  </div>
                </div>

                <button
                  type="submit"
                  class="admin-btn primary"
                  style="margin-top: 20px"
                >
                  Create Course
                </button>
              </form>
            </div>

            <div class="card">
              <h3><i class="fas fa-list"></i> Active Course Sections</h3>
              <div class="table-responsive">
                <table id="courseTable">
                  <thead>
                    <tr>
                      <th>Code [Sec]</th>
                      <th>Name</th>
                      <th>Schedule</th>
                      <th>Enrollment Status</th>
                      <th>Action</th>
                    </tr>
                  </thead>
                  <tbody id="courseList"></tbody>
                </table>
              </div>
            </div>
          </div>

          <div id="view-grades" class="view-section">
            <div class="card">
              <h3>
                <i class="fas fa-file-signature"></i> Upload Student Grades
              </h3>

              <div class="form-grid" style="margin-bottom: 20px">
                <div class="input-group" style="position: relative">
                  <label>Search Student (ID or Name)</label>
                  <input
                    type="text"
                    id="gradeStudentSearch"
                    placeholder="Type to search..."
                    autocomplete="off"
                    onkeyup="searchStudentForGrades()"
                  />
                  <div
                    id="gradeSearchResults"
                    class="search-dropdown"
                    style="display: none"
                  ></div>
                </div>

                <div class="input-group">
                  <label>Selected Student</label>
                  <input
                    id="selectedStudentName"
                    readonly
                    placeholder="No student selected"
                    style="background: #f3f4f6; font-weight: bold"
                  />
                  <input type="hidden" id="selectedStudentDbId" />
                </div>
              </div>

              <div
                id="gradeEntrySection"
                style="
                  display: none;
                  border-top: 2px dashed #e2e8f0;
                  padding-top: 20px;
                "
              >
                <div
                  style="
                    display: flex;
                    justify-content: space-between;
                    align-items: center;
                    margin-bottom: 10px;
                  "
                >
                  <h4 style="margin: 0">Pending Courses (Fall-2025)</h4>
                  <span style="font-size: 0.85em; color: #64748b"
                    >Enter marks to auto-calculate grade</span
                  >
                </div>

                <table class="admin-table">
                  <thead>
                    <tr>
                      <th>Course</th>
                      <th>Credits</th>
                      <th style="width: 120px">Marks (0-100)</th>
                      <th>Grade</th>
                      <th>GPA</th>
                    </tr>
                  </thead>
                  <tbody id="gradeEntryTable"></tbody>
                </table>
                <div style="margin-top: 20px; text-align: right">
                  <button
                    onclick="submitBatchGrades()"
                    class="admin-btn primary"
                  >
                    <i class="fas fa-save"></i> Save & Publish Grades
                  </button>
                </div>
              </div>
            </div>
          </div>

          <div id="view-financials" class="view-section">
            <div class="card">
              <h3>
                <i class="fas fa-file-invoice-dollar"></i> Global Financial
                Status
              </h3>
              <div id="financialsList">Loading...</div>
            </div>
          </div>

          <div id="view-semesters" class="view-section">
            <div class="card">
              <h3><i class="fas fa-calendar-plus"></i> Open New Semester</h3>
              <form class="admin-form" id="addSemesterForm">
                <div class="input-group">
                  <label>Semester Name</label
                  ><input
                    id="semName"
                    placeholder="e.g. Spring-2026"
                    required
                  />
                </div>
                <div class="form-grid">
                  <div class="input-group">
                    <label>Start Date</label
                    ><input type="date" id="semStart" required />
                  </div>
                  <div class="input-group">
                    <label>End Date</label
                    ><input type="date" id="semEnd" required />
                  </div>
                </div>
                <button type="submit" class="admin-btn primary">
                  Open Semester
                </button>
              </form>
            </div>
          </div>

          <div id="view-slots" class="view-section">
            <div class="card">
              <h3><i class="fas fa-clock"></i> Set Advising Time Slots</h3>
              <p style="color: #666; margin-bottom: 15px; font-size: 0.9em">
                Define when students can access advising based on their
                completed credit hours.
              </p>
              <form class="admin-form" id="addSlotForm">
                <div class="form-grid">
                  <div class="input-group">
                    <label>Min Credits</label
                    ><input
                      type="number"
                      id="slotMin"
                      placeholder="e.g. 120"
                      required
                    />
                  </div>
                  <div class="input-group">
                    <label>Max Credits</label
                    ><input
                      type="number"
                      id="slotMax"
                      placeholder="e.g. 140"
                      required
                    />
                  </div>
                  <div class="input-group">
                    <label>Start Time</label
                    ><input type="datetime-local" id="slotStart" required />
                  </div>
                  <div class="input-group">
                    <label>End Time</label
                    ><input type="datetime-local" id="slotEnd" required />
                  </div>
                </div>
                <button type="submit" class="admin-btn primary">
                  Set Advising Window
                </button>
              </form>
            </div>
            <div class="card">
              <h3>Active Advising Windows</h3>
              <div class="table-responsive">
                <table id="slotsTable">
                  <thead>
                    <tr>
                      <th>Credits Range</th>
                      <th>Start Time</th>
                      <th>End Time</th>
                      <th>Status</th>
                      <th>Action</th>
                    </tr>
                  </thead>
                  <tbody id="slotsList"></tbody>
                </table>
              </div>
            </div>
          </div>

          <div id="view-admins" class="view-section">
            <div class="card">
              <h3><i class="fas fa-user-shield"></i> Add New Administrator</h3>
              <form class="admin-form" id="addAdminForm">
                <div class="input-group">
                  <label>Full Name</label><input id="admName" required />
                </div>
                <div class="input-group">
                  <label>Email</label><input id="admEmail" required />
                </div>
                <div class="input-group">
                  <label>Password</label
                  ><input type="password" id="admPassword" required />
                </div>
                <button type="submit" class="admin-btn primary">
                  Create Account
                </button>
              </form>
            </div>
          </div>

          <div id="view-announcements" class="view-section">
            <div class="card">
              <h3><i class="fas fa-bullhorn"></i> Post Announcement</h3>
              <form class="admin-form" id="announcementForm">
                <div class="input-group">
                  <label>Title</label><input id="aTitle" required />
                </div>
                <div class="input-group">
                  <label>Content</label
                  ><textarea id="aContent" rows="3" required></textarea>
                </div>
                <div class="input-group">
                  <label>Category</label
                  ><input id="aCategory" placeholder="e.g. Academic" required />
                </div>
                <button type="submit" class="admin-btn primary">Post</button>
              </form>
            </div>
          </div>
        </div>

        <div class="side-panel">
          <div class="card">
            <h3 class="menu-title">ADMIN TOOLS</h3>
            <div class="nav-menu">
              <button
                class="nav-btn active"
                onclick="switchAdminView('overview', this)"
              >
                <i class="fas fa-chart-line"></i> Overview
              </button>
              <button
                class="nav-btn"
                onclick="switchAdminView('students', this)"
              >
                <i class="fas fa-users"></i> Students
              </button>
              <button
                class="nav-btn"
                onclick="switchAdminView('faculty', this)"
              >
                <i class="fas fa-chalkboard-teacher"></i> Faculty
              </button>
              <button
                class="nav-btn"
                onclick="switchAdminView('courses', this)"
              >
                <i class="fas fa-book"></i> Courses
              </button>
              <button class="nav-btn" onclick="switchAdminView('grades', this)">
                <i class="fas fa-pen-nib"></i> Upload Grades
              </button>
              <button class="nav-btn" onclick="switchAdminView('slots', this)">
                <i class="fas fa-clock"></i> Advising Slots
              </button>
              <button
                class="nav-btn"
                onclick="switchAdminView('semesters', this)"
              >
                <i class="fas fa-calendar-alt"></i> Semesters
              </button>
              <button
                class="nav-btn"
                onclick="switchAdminView('financials', this)"
              >
                <i class="fas fa-file-invoice-dollar"></i> Financials
              </button>
              <button
                class="nav-btn"
                onclick="switchAdminView('announcements', this)"
              >
                <i class="fas fa-bullhorn"></i> Announcements
              </button>
              <button class="nav-btn" onclick="switchAdminView('admins', this)">
                <i class="fas fa-user-plus"></i> Admins
              </button>
            </div>
          </div>
        </div>
      </div>
    </div>

    <div id="studentModal" class="modal-overlay">
      <div class="modal-card">
        <div class="modal-header">
          <h3>Register New Student</h3>
          <button
            class="close-modal"
            onclick="document.getElementById('studentModal').style.display='none'"
          >
            &times;
          </button>
        </div>
        <form id="newStudentForm" class="modal-body">
          <div class="form-grid">
            <div class="input-group">
              <label>Full Name</label><input id="nsName" required />
            </div>
            <div class="input-group">
              <label>Phone</label><input id="nsPhone" />
            </div>

            <div class="input-group">
              <label>Department</label>
              <select id="nsDept" class="admin-input" required>
                <option value="CSE">CSE</option>
                <option value="EEE">EEE</option>
                <option value="BBA">BBA</option>
                <option value="ACT">ACT</option>
                <option value="ENG">ENG</option>
              </select>
            </div>
            <div class="input-group">
              <label>Batch Year</label
              ><input id="nsYear" type="number" placeholder="2025" required />
            </div>
            <div class="input-group">
              <label>Admitted Semester</label>
              <select id="nsSem" class="admin-input">
                <option value="Spring">Spring</option>
                <option value="Summer">Summer</option>
                <option value="Fall" selected>Fall</option>
              </select>
            </div>
            <div class="input-group">
              <label>Program</label
              ><input id="nsProgram" placeholder="B.Sc in CSE" required />
            </div>
          </div>

          <div class="form-section-title">Advisor Assignment</div>
          <div class="form-grid">
            <div class="input-group" style="grid-column: span 2">
              <label>Select Faculty Advisor</label>
              <select id="nsAdvisorSelect" class="admin-input" required>
                <option value="" disabled selected>Loading Faculty...</option>
              </select>
            </div>
          </div>

          <div class="modal-footer">
            <button
              type="button"
              class="admin-btn secondary"
              onclick="document.getElementById('studentModal').style.display='none'"
            >
              Cancel
            </button>
            <button type="submit" class="admin-btn primary">
              Register Student
            </button>
          </div>
        </form>
      </div>
    </div>

    <div id="editStudentModal" class="modal-overlay">
      <div class="modal-card wide-modal">
        <div class="modal-header">
          <h3>Edit Student Profile</h3>
          <button
            class="close-modal"
            onclick="document.getElementById('editStudentModal').style.display='none'"
          >
            &times;
          </button>
        </div>
        <form id="editStudentForm" class="modal-body-scroll">
          <input type="hidden" id="editStudentDbId" />

          <div class="edit-profile-header">
            <div class="profile-icon-placeholder">
              <i class="fas fa-user"></i>
            </div>
            <div class="profile-main-inputs">
              <div class="input-group">
                <label>Full Name</label>
                <input id="editName" class="highlight-input" required />
              </div>
              <div class="input-group">
                <label>Student ID</label>
                <input id="editStudentId" readonly class="readonly-input" />
              </div>
            </div>
          </div>

          <div class="edit-grid-layout">
            <div class="edit-column">
              <div class="form-section-title">
                <i class="fas fa-graduation-cap"></i> Academic Info
              </div>
              <div class="input-group">
                <label>Department</label><input id="editDept" required />
              </div>
              <div class="input-group">
                <label>Program</label><input id="editProgram" required />
              </div>
              <div class="form-row-compact">
                <div class="input-group">
                  <label>Year</label><input id="editYear" required />
                </div>
                <div class="input-group">
                  <label>Semester</label><input id="editSemester" required />
                </div>
              </div>

              <div class="form-section-title">
                <i class="fas fa-chalkboard-teacher"></i> Advisor
              </div>
              <div class="input-group">
                <label>Assign Faculty Advisor</label>
                <select id="editAdvisorSelect" class="admin-input">
                  <option value="" disabled selected>Loading Faculty...</option>
                </select>
              </div>
            </div>

            <div class="edit-column">
              <div class="form-section-title">
                <i class="fas fa-address-card"></i> Personal & Contact
              </div>
              <div class="input-group">
                <label>Email</label
                ><input id="editEmail" readonly class="readonly-input" />
              </div>
              <div class="input-group">
                <label>Phone</label><input id="editPhone" />
              </div>
              <div class="form-row-compact">
                <div class="input-group">
                  <label>DOB</label><input id="editDob" type="date" />
                </div>
                <div class="input-group">
                  <label>Blood Group</label><input id="editBlood" />
                </div>
              </div>
              <div class="input-group">
                <label>Present Address</label><input id="editPresentAddr" />
              </div>
            </div>
          </div>

          <div class="course-management-section">
            <div
              class="form-section-title"
              style="color: var(--primary); border-color: var(--primary-light)"
            >
              <i class="fas fa-book"></i> Course Enrollment
            </div>
            <div class="course-actions">
              <div id="adminAddCourseCodeContainer" style="flex: 1">
                <input
                  id="adminAddCourseCode"
                  placeholder="Select Course..."
                  class="course-input"
                  style="width: 100%"
                />
              </div>
              <button
                type="button"
                class="admin-btn primary small"
                onclick="adminAddCourseToStudent()"
              >
                Enroll
              </button>
            </div>
            <div id="adminStudentCoursesList" class="course-list-container">
              <p class="empty-text">Loading courses...</p>
            </div>
            <div class="semester-actions">
              <button
                type="button"
                class="admin-btn danger small"
                onclick="adminDropSemesterForStudent()"
              >
                Drop Entire Semester
              </button>
            </div>
          </div>

          <div class="modal-footer">
            <button
              type="button"
              class="admin-btn secondary"
              onclick="document.getElementById('editStudentModal').style.display='none'"
            >
              Cancel
            </button>
            <button type="submit" class="admin-btn primary">
              Save Changes
            </button>
          </div>
        </form>
      </div>
    </div>

    <div id="facultyModal" class="modal-overlay">
      <div class="modal-card">
        <div class="modal-header">
          <h3>Add New Faculty</h3>
          <button
            class="close-modal"
            onclick="document.getElementById('facultyModal').style.display='none'"
          >
            &times;
          </button>
        </div>
        <form id="newFacultyForm" class="modal-body">
          <div class="form-grid">
            <div class="input-group">
              <label>Full Name</label
              ><input id="nfName" required placeholder="e.g. Dr. John Doe" />
            </div>

            <div class="input-group">
              <label>Department</label>
              <select id="nfDept" class="admin-input" required>
                <option value="CSE">CSE</option>
                <option value="EEE">EEE</option>
                <option value="BBA">BBA</option>
                <option value="ACT">ACT</option>
                <option value="ENG">ENG</option>
              </select>
            </div>

            <div class="input-group">
              <label>Designation</label>
              <select id="nfDesignation" class="admin-input" required>
                <option value="Lecturer">Lecturer</option>
                <option value="Senior Lecturer">Senior Lecturer</option>
                <option value="Assistant Professor">Assistant Professor</option>
                <option value="Professor">Professor</option>
              </select>
            </div>
          </div>

          <div class="modal-footer">
            <button
              type="button"
              class="admin-btn secondary"
              onclick="document.getElementById('facultyModal').style.display='none'"
            >
              Cancel
            </button>
            <button type="submit" class="admin-btn primary">Add Faculty</button>
          </div>
        </form>
      </div>
    </div>

    <script src="admin.js"></script>
  </body>
</html>
